<?xml version='1.0' standalone='yes'?>
<!DOCTYPE PLUGIN [
        <!ENTITY name        "DummyPlg">
        <!ENTITY author      "IllusionaryX">
        <!ENTITY version     "2025.08.12b3">
        <!ENTITY sha256      "32c804e2dc64fd79fe580858f4ee0b13a99651f3fba40ad016e9f0219bdc88f4">
        <!ENTITY launch      "Settings/DummyPlg">
        <!ENTITY plugdir     "/usr/local/emhttp/plugins/&name;">
        <!ENTITY gitBaseURL  "https://raw.githubusercontent.com/">
        <!ENTITY githubRepo  "IllusionaryX/urplugins-dummyplg">
        <!ENTITY releasePath "&version;/">
        <!ENTITY pluginURL   "&gitBaseURL;&githubRepo;/master/&name;.plg">
        ]>

<PLUGIN name="&name;" 
        author="&author;" 
        version="&version;" 
        launch="&launch;" 
        pluginURL="&pluginURL;" 
        icon="suitcase"
        min="6.12" 
        support="https://forums.unraid.net/topic/">

    <CHANGES>
        <![CDATA[
            âž•New  ðŸ©¹Fix ðŸ”§Change

            ### 2025.08.12b1
            - âž• Various fixes for persisting issues preventing fully functional plugin template.

            ### 2025.08.11b1
            - âž• Update .plg Path Structure

            ### 2025.07.30b1
            - âž• Alpha Release
        ]]>
    </CHANGES>


    <FILE Run="/bin/bash">
        <INLINE>
            OLDVERS=$(ls /boot/config/plugins/&name;/*.tgz 2>/dev/null | grep -v '&version;')
            if [ ! -z "$OLDVERS" ]
            then
                echo "Cleaning old archives..."
                rm $OLDVERS
            else
                echo "No cleanup of old plugin archive needed!"
            fi

            if [ -d "&plugdir;" ]
            then
                echo "Removing plugin files..."
                rm -rf &plugdir;
            else
                echo "Plugin files were not present. Fresh install"
            fi

            echo "Creating plugin files directory..."
            mkdir &plugdir;
        </INLINE>
    </FILE>

    <FILE Name="/boot/config/plugins/&name;/&name;-&version;.tgz">
        <URL>https://github.com/&githubRepo;/releases/download/&releasePath;&name;-&version;.tgz</URL>
        <SHA256>&sha256;</SHA256>
    </FILE>

    <!-- Create default.cfg -->
    <FILE Name="&plugdir;/settings.json">
        <INLINE>
            <![CDATA[
{
    "base_options": {
    "debug": true
    },
    "sections": [
        {
          "section_name": "First Section",
          "section_content": [
            "WelcomeBldr",
            "StatusBldr",
            "LiveViewBldr"
          ]
        },
        {
          "section_name": "Second Section",
          "section_content": [
            "SelectionBldr"
          ]
        }
    ],
    "optimisations": {
    "minimize_output": true
    }
}

            ]]>
        </INLINE>
    </FILE>


    <FILE Run="/bin/bash">
        <INLINE>
            echo "Extracting plugin files..."
            tar -C &plugdir; -xzf /boot/config/plugins/&name;/&name;-&version;.tgz 2>&amp;1
        </INLINE>
    </FILE>

    <FILE Run="/bin/bash">
        <INLINE>
            echo -n "&version;" > &plugdir;/version
        </INLINE>
    </FILE>

    <FILE Run="/bin/bash">
        <INLINE>
            echo ""
            echo "----------------------------------------------------"
            echo " &name; has been installed."
            echo " Version: &version;"
            echo ""
            echo " Year: 2025"
            echo " Built by: &author;"
            echo "----------------------------------------------------"
            echo ""
        </INLINE>
    </FILE>

    <!--
    The 'remove' script.
    -->
    <FILE Run="/bin/bash" Method="remove">
        <INLINE>
            echo "Uninstalling... ðŸ˜­ Maybe I'll see you again. Bye!"
            rm -rf &plugdir; 2>/dev/null
            rm -rf /boot/config/plugins/&name;
            update_cron # Let cron know, we removed the target files..
            echo "Uninstall done."
        </INLINE>
    </FILE>
</PLUGIN>
